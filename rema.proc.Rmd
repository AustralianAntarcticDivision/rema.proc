---
title: "REMA topography processing"
author: "Michael Sumner"
date: "9/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Notes

arock.R batch started at 11.02 am September 14

## arock.R

   reads

      - rock layer shapefile
      - dataframe of all REMA 8m tiles, the GeoTIFF path and the bounding box polygon, and tile identifier

loops every tile, burns the rock layer into the tile, saves rock-mask tile iff rock polygon is present


## Data sources

ADD Rock outcrop shapfile 'add_rockoutcrop_landsat_v7.2.shp'

REMA 8m tiles (via bowerbird/raadtools)


## Work in progress


Create an index of progress so far, boxes with red cross are rock-containing tiles. Boxes with label have been classified by rock presence. (About 8 hours to run). 

```{r}
library(raadtools)
print(getwd())
files <- raadfiles::rema_8m_files()
files$tile <- basename(dirname(files$fullname))
polytiles <- raadtools::read_rema_tiles()
polytiles$fullname <- files$fullname[match(polytiles$tile, files$tile)]


ff <- list.files("rockraster/")
tl <- substr(ff, 1, 5)
png(glue::glue("/perm_storage/home/mdsumner/Git/rema.proc/index_rock_{logn}.png"))
plot(polytiles, border = "lightgrey")
logn <- as.integer(readLines("logfile"))
points(coordinates(polytiles)[match(tl, polytiles$tile), ], col = "firebrick", pch = "X")
text(coordinates(polytiles)[1:logn, ], lab = 1:logn, cex = 0.5)
for (i in list.files("rockraster", full.names = TRUE)) plot(extent(raster(i)), add = TRUE)
dev.off()

```

